---
title: "RxSwift + UITableView ë¬´í•œìŠ¤í¬ë¡¤ êµ¬í˜„í•˜ê¸°"
date: 2021-05-30 15:31:28 -0400
categories: RxSwift 
toc: true
tags:
 - UIScrollView + Rx
 - UITableView Event ì „ë‹¬
 - In ViewModel
---

ì—¬ëŸ¬ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë‹¤ë³´ë©´ UITableViewë¥¼ ì´ìš©í•´ ë¬´í•œìŠ¤í¬ë¡¤ì„ êµ¬í˜„í•´ì•¼í•˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.

ì €ë„ í•™êµì—ì„œ í”„ë¡œì íŠ¸ë“¤ì„ ì§„í–‰í•˜ì˜€ëŠ”ë° ë¬´í•œìŠ¤í¬ë¡¤ì„ ì‚¬ìš©ì•ˆí•˜ëŠ” í”„ë¡œì íŠ¸ë¥¼ ì°¾ê¸° ì–´ë ¤ìš¸ë§Œí¼ ê°€ì¥ ë³´í¸ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. ì´ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œ ìš°ë¦¬ê°€ ì•Œì•„ì•¼í•  ê²ƒì€ UITableViewê°€ ì–¸ì œ ìŠ¤í¬ë¡¤ì´ ë°”ë‹¥ì— ë„ë‹¬í•˜ëŠ”ì§€ê°€ ìŸì ì…ë‹ˆë‹¤. 

ë³µì¡í•  ê²ƒ ê°™ì§€ë§Œ ì˜ì™¸ë¡œ ê°„ë‹¨í•˜ê²Œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. RxSwiftë¥¼ ì´ìš©í•´ ë¬´í•œìŠ¤í¬ë¡¤ì„ êµ¬í˜„í•´ë´…ì‹œë‹¤



### â˜ğŸ»UIScrollView+Rx

```swift
extension UIScrollView {
    var reachedBottom: Observable<Void> {
        return rx.contentOffset
            .flatMap { [weak self] contentOffset -> Observable<Void> in
                guard let scrollView = self else {
                    return Observable.empty()
                }
                
                let visibleHeight = scrollView.frame.height - scrollView.contentInset.top - scrollView.contentInset.bottom
                let y = contentOffset.y + scrollView.contentInset.top
                let threshold = max(0.0, scrollView.contentSize.height - visibleHeight)
                
                return y > threshold ? Observable.just(()) : Observable.empty()
            }
    }
}
```

 ë¨¼ì € UITableViewì— UIScrollViewê°€ ë‚´ì¥ë˜ì–´ìˆê³  ë¬´í•œìŠ¤í¬ë¡¤ì€ í˜„ì¬ ìŠ¤í¬ë¡¤ ëœ ê°’ì„ ì•Œì•„ì•¼í•˜ê¸° ë•Œë¬¸ì— UIScrollViewë¥¼ Extension í•´ì£¼ì—ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  <code>reachedBottom</code> ë³€ìˆ˜ë¡œ ë§Œì•½ ìŠ¤í¬ë¡¤ ì§€ì ì´ ë°”ë‹¥ì´ë¼ë©´ Voidë¡œ ì´ë²¤íŠ¸ë¥¼ ë„˜ê²¨ì£¼ê³  ì•„ë‹ˆë¼ë©´ empty()ë¥¼ ì£¼ì—ˆìŠµë‹ˆë‹¤.



### âœŒğŸ»UITableView Event ì „ë‹¬

í”„ë¡œì íŠ¸ëŠ” RxSwift+MVVMìœ¼ë¡œ êµ¬ì„±ë˜ì–´ìˆê¸° ë•Œë¬¸ì— ì•„ë˜ì˜ ì½”ë“œëŠ” VCì—ì„œ VMìœ¼ë¡œ ë°”ì¸ë”©ì„ í•´ì£¼ëŠ” ì½”ë“œì…ë‹ˆë‹¤.

```swift
let input = MainViewModel.Input(getPosts: getData.asSignal(onErrorJustReturn: ()),
                                        loadDetail: mainTableView.rx.itemSelected.asSignal(),
                                        postScrap: selectScrap.asSignal(),
                                        getMorePosts: mainTableView.reachedBottom.asSignal(onErrorJustReturn: ()),
                                        getOtherProfile: selectProfile.asSignal())
let output = viewModel.transform(input)
```



getMorePostsë¥¼ ë³´ë©´

 <code>mainTableView.reachedBottom.asSignal(onErrorJustReturn: ())</code> 

ì—¬ê¸°ì„œ UITableViewê°€ ìŠ¤í¬ë¡¤ì˜ ë°”ë‹¥ì— ìœ„ì¹˜í•œë‹¤ë©´ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•œë‹¤ê³  ë³´ì—¬ì§€ê³  ìˆìŠµë‹ˆë‹¤.





### ğŸ‘ŒğŸ»In ViewModel

```swift
input.getMorePosts.asObservable()
            .map { pagination += 1 }
            .flatMap { _ in api.getPosts(pagination)}
            .subscribe(onNext: { data, response in
                print(response)
                switch response {
                case .ok:
                    for i in data!.data {
                        getPostsData.add(element: i)
                    }
                default:
                    result.onNext("ì„œë²„ ì˜¤ë¥˜")
                }
            }).disposed(by: disposeBag)
```

ì—¬ê¸°ì„œ getMorePostsì˜ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬ë°›ì•˜ë‹¤ë©´ ë¶ˆëŸ¬ì˜¬ í˜„ì¬ í˜ì´ì§€ë¥¼ +1 ì‹œí‚¤ê³  apië¥¼ ìš”ì²­í•©ë‹ˆë‹¤. ê·¸ë ‡ê²Œ ë°›ì•„ì˜¨ ê°’ë“¤ì„ getPostsDataì— ë„£ì–´ì£¼ê³  Outputìœ¼ë¡œ ë³´ë‚´ì£¼ë©´ì€ paginationì´ ëì´ ë‚©ë‹ˆë‹¤..!



-----

### ì¶œì²˜

https://github.com/RGSSoftware/UIScrollViewReachedBottom
